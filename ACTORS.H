namespace mm {


// one-word synonyms for unsigned integral types
typedef unsigned char uchar;
typedef unsigned short ushort;
typedef unsigned int uint;
typedef unsigned long ulong;

// TIME definition
typedef double TIME;

// real definition
typedef float real;

// counter definition
typedef ushort counter;

// integer definition
typedef short integer;

// index definition
typedef ulong index;

// logical definition
typedef uint logical;

// time constants
CONSTANT( TIME, ANY_AGE, (TIME) -1 );
CONSTANT( TIME, TIME_UNDEF, (TIME) -1 );
CONSTANT( TIME, TIME_INFINITE, (TIME) SHRT_MAX );

extern Thread EventQueue *gpoEventQueue;

void SetCaseWeight( double dCaseWeight, double dCaseSubsampleWeight = UNUSED_VALUE );

// classifications

// ranges
typedef uint INCIDENCE_RATES_SOURCE;
CONSTANT( int, r_min_INCIDENCE_RATES_SOURCE, 0 );
CONSTANT( int, r_max_INCIDENCE_RATES_SOURCE, 2 );
CONSTANT( int, rc_size_INCIDENCE_RATES_SOURCE, 3 );
typedef uint LIFE;
CONSTANT( int, r_min_LIFE, 0 );
CONSTANT( int, r_max_LIFE, 100 );
CONSTANT( int, rc_size_LIFE, 101 );
typedef uint REPORT_TIME;
CONSTANT( int, r_min_REPORT_TIME, 0 );
CONSTANT( int, r_max_REPORT_TIME, 200 );
CONSTANT( int, rc_size_REPORT_TIME, 201 );

// partitions
typedef uint INCIDENCE_AGE_GROUPS;
CONSTANT( int, rc_size_INCIDENCE_AGE_GROUPS, 13 );
extern real p_points_INCIDENCE_AGE_GROUPS[];
typedef uint INFECTION_AGES;
CONSTANT( int, rc_size_INFECTION_AGES, 14 );
extern real p_points_INFECTION_AGES[];

class Parameters {
	public:
		Parameters();

		double	FertilityRates
[rc_size_LIFE];
		double	IncidenceRates
[rc_size_INCIDENCE_RATES_SOURCE]
[rc_size_LIFE];
		INCIDENCE_RATES_SOURCE	IncidenceRatesSource;
		double	MaxBirthWait;
		int	MaxChildren;
		double	MaxInfWait;
		double	MaxLife;
		double	MinBirthWait;
		double	MinInfWait;
		int	StartingPopulationSize;
};

extern Parameters	*gprParam;


class Child;
class Mother;
class Ticker;


class ChildTable {
	public:
		ChildTable() { };

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		double	tab0events;
		double	tab1events;
		double	tab2events;
		double	tab3events;
		double	tab4events;
		//   group=float
		real	tab0open0;
		real	tab0close0;
		real	tab0open1;
		real	tab0close1;
		real	tab0open2;
		real	tab0close2;
		real	tab0open3;
		real	tab0close3;
		real	tab1open0;
		real	tab1close0;
		real	tab1open1;
		real	tab1close1;
		real	tab2open0;
		real	tab2close0;
		real	tab3open0;
		real	tab3close0;
		real	tab3open1;
		real	tab3close1;
		real	tab4open0;
		real	tab4close0;
		//   group=long
		//   group=ulong
		index	tab0cell;
		index	tab0total_cell;
		index	tab1cell;
		index	tab1total_cell;
		index	tab2cell;
		index	tab2total_cell;
		index	tab3cell;
		index	tab3total_cell;
		index	tab4cell;
		index	tab4total_cell;
		//   group=int
		//   group=uint
		logical	tab0dim_filter : 1;
		logical	tab1dim_filter : 1;
		logical	tab2dim_filter : 1;
		logical	tab3dim_filter : 1;
		logical	tab4dim_filter : 1;
		//   group=short
		//   group=ushort
		//   group=char
		//   group=uchar
		// end MembersDump

};

class Child : public ActorClass {
	public:
		TIME	__time;
		double	__events;
		class ChildStateFunctions	*poStateFunctions;
		class ChildDerivedStates	*poDerivedStates;
		class ChildTable	tableinfo;
		void *operator new( size_t count );

		// links to other actors
		class Mother	*lMother;
		void	Set_lMother( Mother *value );

		// user-supplied data members

		// user-supplied and required functions
		Child() { };
		void Finish ( ) ; 
		void Mother_Infect ( ) ; 
		void Start ( ) ; 

		// special functions generated by the pre-compiler
		Child( BOOL bInit ) { InitActor(); };
		~Child() { DeleteActor(); };
		void	InitActor();
		void	DeleteActor();
		void	InitializeStates();
		void	UpdateLinkedStates();
		void	StartSpecial1();
		void	StartSpecial2();
		void	FinishSpecial();
		void	WaitUntil( double target_time );
		Child	*UpdateTime( );
		void	WaitUntilThisActor(double target_time);
		void	WaitSpecial( TIME wait_time );

		// actor set nodes
		ActorSetNode	*poasAllChild;

		// event functions and variables
		void __fastcall	ScheduleEvent();
		TIME __fastcall	timeScheduleEvent();
		Event	*poScheduleEvent;
		TIME schedule_event_time;

		// event processing functions
		double	EventTime( int nEventNum, int *pnEventInfo );
		void	Implement( int nEventNum, int nEventInfo );

		// state variables and their special functions
		long	Get_actor_id() { return actor_id; };
		double	Set_actor_subsample_weight( double value );
		double	Set_actor_weight( double value );

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		double	actor_subsample_weight;
		double	actor_weight;
		TIME	age;
		double	case_seed;
		TIME	time;
		TIME	duration__max_value_out;
		TIME	duration__min_value_out;
		//   group=float
		//   group=long
		long	actor_id;
		long	case_id;
		//   group=ulong
		//   group=int
		//   group=uint
		logical	alive : 1;
		logical	mother_infected_fm : 1;
		REPORT_TIME	report_time : 8;
		logical	actorset_filter_asAllChild : 1;
		logical	alive_value_in : 1;
		logical	mother_infected_dl : 1;
		logical	table_filter_DurationOfLifea : 1;
		logical	table_filter_Infection_count_dl : 1;
		logical	table_filter_Infection_count_fm : 1;
		logical	table_filter_InfectionAgeHist_dl : 1;
		logical	table_filter_InfectionAgeHist_fm : 1;
		logical	lMother_infected : 1;
		logical	__finished : 1;
		//   group=short
		//   group=ushort
		counter	table_unit_Infection_count_dl;
		counter	table_unit_Infection_count_fm;
		//   group=char
		//   group=uchar
		// end MembersDump

};

class ChildStateFunctions {
	public:
		ChildStateFunctions() { };
		class Child	*poParent;
		class ChildDerivedStates	*poDerivedStates;

		// state special functions
		double	Set_actor_subsample_weight( double value ){ return poParent->actor_subsample_weight = value; };
		double	Set_actor_weight( double value ){ return poParent->actor_weight = value; };
		TIME	Set_age( TIME value, bool bStartFunction = false );
		logical	Set_alive( logical value );
		logical	Set_mother_infected_fm( logical value );
		REPORT_TIME	Set_report_time( REPORT_TIME value );
		counter	Set_table_unit_Infection_count_dl( counter value );
		counter	Set_table_unit_Infection_count_fm( counter value );
		TIME	Set_time( TIME value, bool bStartFunction = false ){ return poParent->time = value; };
		logical	Set_actorset_filter_asAllChild( logical value );
		logical	Set_alive_value_in( logical value );
		TIME	Set_duration__max_value_out( TIME value );
		TIME	Get_duration__max_value_out();
		TIME	Set_duration__min_value_out( TIME value );
		TIME	Get_duration__min_value_out();
		logical	Set_mother_infected_dl( logical value );
		logical	Set_table_filter_DurationOfLifea( logical value );
		logical	Set_table_filter_Infection_count_dl( logical value );
		logical	Set_table_filter_Infection_count_fm( logical value );
		logical	Set_table_filter_InfectionAgeHist_dl( logical value );
		logical	Set_table_filter_InfectionAgeHist_fm( logical value );
		logical	Set_lMother_infected( logical value );
};

class ChildDerivedStates {
	public:
		ChildDerivedStates() { };
		class Child	*poParent;
		class ChildStateFunctions	*poStateFunctions;

		// derived state variables and their special functions
		TIME	Set_duration_( TIME value );
		TIME	Get_duration_() { return duration_ + poParent->__time - duration__time; };
		counter	Set_entrances_alive_FALSE( counter value );
		counter	Set_entrances_mother_infected_dl_TRUE( counter value );
		counter	Set_entrances_mother_infected_fm_TRUE( counter value );
		INFECTION_AGES	Set_sssplit_age_INFECTION_AGES( INFECTION_AGES value );

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		TIME	duration_;
		TIME	duration__time;
		TIME	sssplit_age_INFECTION_AGES_time;
		//   group=float
		//   group=long
		//   group=ulong
		//   group=int
		//   group=uint
		INFECTION_AGES	sssplit_age_INFECTION_AGES : 4;
		//   group=short
		//   group=ushort
		counter	entrances_alive_FALSE;
		counter	entrances_mother_infected_dl_TRUE;
		counter	entrances_mother_infected_fm_TRUE;
		//   group=char
		//   group=uchar
		// end MembersDump

};

class MotherTable {
	public:
		MotherTable() { };

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		double	tab5events;
		double	tab6events;
		double	tab7events;
		double	tab7events0;
		double	tab7events1;
		double	tab8events;
		//   group=float
		real	tab5open0;
		real	tab5close0;
		real	tab6open0;
		real	tab6close0;
		real	tab6open1;
		real	tab6close1;
		real	tab6open2;
		real	tab6close2;
		real	tab6open3;
		real	tab6close3;
		real	tab7open0;
		real	tab7close0;
		real	tab7prev0;
		real	tab7open1;
		real	tab7close1;
		real	tab7prev1;
		real	tab8open0;
		real	tab8close0;
		real	tab8open1;
		real	tab8close1;
		//   group=long
		//   group=ulong
		index	tab5cell;
		index	tab5total_cell;
		index	tab6cell;
		index	tab6total_cell;
		index	tab7cell;
		index	tab7total_cell;
		index	tab8cell;
		index	tab8total_cell;
		//   group=int
		//   group=uint
		logical	tab5dim_filter : 1;
		logical	tab6dim_filter : 1;
		logical	tab7dim_filter : 1;
		logical	tab8dim_filter : 1;
		//   group=short
		//   group=ushort
		//   group=char
		//   group=uchar
		// end MembersDump

};

class Mother : public ActorClass {
	public:
		TIME	__time;
		double	__events;
		class MotherStateFunctions	*poStateFunctions;
		class MotherDerivedStates	*poDerivedStates;
		class MotherTable	tableinfo;
		void *operator new( size_t count );

		// links to other actors
		class Mother_mlChild	*mlChild;

		// user-supplied data members

		// user-supplied and required functions
		Mother() { };
		void Finish ( ) ; 
		void Start ( ) ; 

		// special functions generated by the pre-compiler
		Mother( BOOL bInit ) { InitActor(); };
		~Mother() { DeleteActor(); };
		void	InitActor();
		void	DeleteActor();
		void	InitializeStates();
		void	UpdateLinkedStates();
		void	StartSpecial1();
		void	StartSpecial2();
		void	FinishSpecial();
		void	WaitUntil( double target_time );
		Mother	*UpdateTime( );
		void	WaitUntilThisActor(double target_time);
		void	WaitSpecial( TIME wait_time );

		// actor set nodes
		ActorSetNode	*poasAllMother;

		// event functions and variables
		void __fastcall	ScheduleEvent();
		TIME __fastcall	timeScheduleEvent();
		Event	*poScheduleEvent;
		TIME schedule_event_time;
		void __fastcall	BirthEvent();
		TIME __fastcall	timeBirthEvent();
		Event	*poBirthEvent;
		void __fastcall	InfectionEvent();
		TIME __fastcall	timeInfectionEvent();
		Event	*poInfectionEvent;

		// event processing functions
		double	EventTime( int nEventNum, int *pnEventInfo );
		void	Implement( int nEventNum, int nEventInfo );

		// state variables and their special functions
		long	Get_actor_id() { return actor_id; };
		double	Set_actor_subsample_weight( double value );
		double	Set_actor_weight( double value );

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		double	actor_subsample_weight;
		double	actor_weight;
		TIME	age;
		double	case_seed;
		TIME	time;
		TIME	duration__max_value_out;
		TIME	duration__min_value_out;
		//   group=float
		real	value_at_changes_infected_age_event;
		//   group=long
		long	actor_id;
		long	case_id;
		//   group=ulong
		//   group=int
		int	number_children;
		//   group=uint
		logical	alive : 1;
		logical	infected : 1;
		REPORT_TIME	report_time : 8;
		logical	actorset_filter_asAllMother : 1;
		logical	alive_value_in : 1;
		LIFE	integer_age : 7;
		logical	table_filter_ageAtBirth : 1;
		logical	table_filter_DurationOfLife : 1;
		logical	table_filter_InfectionAge : 1;
		logical	table_filter_InfectionAgeHist : 1;
		logical	__finished : 1;
		//   group=short
		//   group=ushort
		counter	changes_infected_event;
		//   group=char
		//   group=uchar
		// end MembersDump

};

class MotherStateFunctions {
	public:
		MotherStateFunctions() { };
		class Mother	*poParent;
		class MotherDerivedStates	*poDerivedStates;

		// state special functions
		double	Set_actor_subsample_weight( double value ){ return poParent->actor_subsample_weight = value; };
		double	Set_actor_weight( double value ){ return poParent->actor_weight = value; };
		TIME	Set_age( TIME value, bool bStartFunction = false );
		logical	Set_alive( logical value );
		logical	Set_infected( logical value );
		int	Set_number_children( int value );
		int	PlusPlusSet_number_children() { int old_value; old_value = poParent->number_children;
			Set_number_children((int) (poParent->number_children + 1)); return old_value; };
		REPORT_TIME	Set_report_time( REPORT_TIME value );
		TIME	Set_time( TIME value, bool bStartFunction = false ){ return poParent->time = value; };
		logical	Set_actorset_filter_asAllMother( logical value );
		logical	Set_alive_value_in( logical value );
		counter	Set_changes_infected_event( counter value );
		TIME	Set_duration__max_value_out( TIME value );
		TIME	Get_duration__max_value_out();
		TIME	Set_duration__min_value_out( TIME value );
		TIME	Get_duration__min_value_out();
		LIFE	Set_integer_age( LIFE value );
		logical	Set_table_filter_ageAtBirth( logical value );
		logical	Set_table_filter_DurationOfLife( logical value );
		logical	Set_table_filter_InfectionAge( logical value );
		logical	Set_table_filter_InfectionAgeHist( logical value );
		real	Set_value_at_changes_infected_age_event( real value );
};

class MotherDerivedStates {
	public:
		MotherDerivedStates() { };
		class Mother	*poParent;
		class MotherStateFunctions	*poStateFunctions;

		// derived state variables and their special functions
		counter	Set_changes_infected( counter value );
		counter	Set_changes_number_children( counter value );
		TIME	Set_duration_( TIME value );
		TIME	Get_duration_() { return duration_ + poParent->__time - duration__time; };
		counter	Set_entrances_alive_FALSE( counter value );
		counter	Set_entrances_infected_TRUE( counter value );
		counter	Set_ssint_age( counter value );
		INFECTION_AGES	Set_sssplit_age_INFECTION_AGES( INFECTION_AGES value );
		real	Set_value_at_changes_infected_age( real value );

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		TIME	duration_;
		TIME	duration__time;
		TIME	ssint_age_time;
		TIME	sssplit_age_INFECTION_AGES_time;
		//   group=float
		real	value_at_changes_infected_age;
		//   group=long
		//   group=ulong
		//   group=int
		//   group=uint
		INFECTION_AGES	sssplit_age_INFECTION_AGES : 4;
		//   group=short
		//   group=ushort
		counter	changes_infected;
		counter	changes_number_children;
		counter	entrances_alive_FALSE;
		counter	entrances_infected_TRUE;
		counter	ssint_age;
		//   group=char
		//   group=uchar
		// end MembersDump

};

class Ticker : public ActorClass {
	public:
		TIME	__time;
		double	__events;
		class TickerStateFunctions	*poStateFunctions;
		class TickerDerivedStates	*poDerivedStates;
		void *operator new( size_t count );

		// links to other actors

		// user-supplied data members

		// user-supplied and required functions
		Ticker() { };
		void Finish ( ) ; 
		void Start ( ) ; 

		// special functions generated by the pre-compiler
		Ticker( BOOL bInit ) { InitActor(); };
		~Ticker() { DeleteActor(); };
		void	InitActor();
		void	DeleteActor();
		void	InitializeStates();
		void	UpdateLinkedStates();
		void	StartSpecial1();
		void	StartSpecial2();
		void	FinishSpecial();
		void	WaitUntil( double target_time );
		Ticker	*UpdateTime( );
		void	WaitUntilThisActor(double target_time);
		void	WaitSpecial( TIME wait_time );

		// event functions and variables
		void __fastcall	TickEvent();
		TIME __fastcall	timeTickEvent();
		Event	*poTickEvent;

		// event processing functions
		double	EventTime( int nEventNum, int *pnEventInfo );
		void	Implement( int nEventNum, int nEventInfo );

		// state variables and their special functions
		long	Get_actor_id() { return actor_id; };
		double	Set_actor_subsample_weight( double value );
		double	Set_actor_weight( double value );

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		double	actor_subsample_weight;
		double	actor_weight;
		TIME	age;
		double	case_seed;
		TIME	next_tick;
		TIME	time;
		//   group=float
		//   group=long
		long	actor_id;
		long	case_id;
		//   group=ulong
		//   group=int
		//   group=uint
		REPORT_TIME	report_time : 8;
		logical	__finished : 1;
		//   group=short
		//   group=ushort
		//   group=char
		//   group=uchar
		// end MembersDump

};

class TickerStateFunctions {
	public:
		TickerStateFunctions() { };
		class Ticker	*poParent;
		class TickerDerivedStates	*poDerivedStates;

		// state special functions
		double	Set_actor_subsample_weight( double value ){ return poParent->actor_subsample_weight = value; };
		double	Set_actor_weight( double value ){ return poParent->actor_weight = value; };
		TIME	Set_age( TIME value, bool bStartFunction = false ){ return poParent->age = value; };
		TIME	Set_next_tick( TIME value );
		REPORT_TIME	Set_report_time( REPORT_TIME value );
		TIME	Set_time( TIME value, bool bStartFunction = false ){ return poParent->time = value; };
};

class TickerDerivedStates {
	public:
		TickerDerivedStates() { };
		class Ticker	*poParent;
		class TickerStateFunctions	*poStateFunctions;

		// derived state variables and their special functions

		// begin MembersDump
		//   group=<unknown token type>
		//   group=double
		//   group=float
		//   group=long
		//   group=ulong
		//   group=int
		//   group=uint
		//   group=short
		//   group=ushort
		//   group=char
		//   group=uchar
		// end MembersDump

};

// global actor declarations
extern Thread Child	*gpoEmptyChild;
typedef CTypedPtrArray<CObArray, Child*> ChildArray;
void	DeleteAllChildActors();
extern Thread Mother	*gpoEmptyMother;
typedef CTypedPtrArray<CObArray, Mother*> MotherArray;
void	DeleteAllMotherActors();
extern Thread Ticker	*gpoEmptyTicker;
typedef CTypedPtrArray<CObArray, Ticker*> TickerArray;
void	DeleteAllTickerActors();

class Mother_mlChild : public CObject {
	public:
		Mother_mlChild( Mother *pObject ) { prParentMother = pObject; };
		void	Add( Child *prChild );
		void	Remove( Child *prChild );
		void	RemoveAll();
		void	Finish();
		void	FinishAll();
		Child	*GetNext( int nInitPos, int *pnPos );
		void	UpdateReferences();
		Mother	*prParentMother;
		ChildArray	arData;
};

class asAllChildActorSetTree : public ActorSetTree	{
	public:
		asAllChildActorSetTree() {m_nId = 0;};
		~asAllChildActorSetTree() {};
		Child	* Item(int nIndex) {return (Child *) ActorSetTree::Item(nIndex);};
		Child	* GetRandom(double dRandom) {return (Child *) ActorSetTree::GetRandom(dRandom);};
		int	ActorCompare(ActorClass *poActor1, ActorClass *poActor2);

	private:
		ActorSetNode *RemoveAll() {return ActorSetTree::RemoveAll();}
};
extern Thread asAllChildActorSetTree	*asAllChild;

class asAllMotherActorSetTree : public ActorSetTree	{
	public:
		asAllMotherActorSetTree() {m_nId = 1;};
		~asAllMotherActorSetTree() {};
		Mother	* Item(int nIndex) {return (Mother *) ActorSetTree::Item(nIndex);};
		Mother	* GetRandom(double dRandom) {return (Mother *) ActorSetTree::GetRandom(dRandom);};
		int	ActorCompare(ActorClass *poActor1, ActorClass *poActor2);

	private:
		ActorSetNode *RemoveAll() {return ActorSetTree::RemoveAll();}
};
extern Thread asAllMotherActorSetTree	*asAllMother;


} // namespace 
